<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>리뷰 상세보기</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .review-container {
            margin: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .comment-section {
            margin-top: 20px;
        }
        .error-message {
            color: red;
            margin-top: 10px;
        }
    </style>
    <script>
        function addComment(event) {
            event.preventDefault(); // 기본 폼 제출 동작 방지
            const reviewNo = document.getElementById('reviewNo').value;
            const commentsContent = document.getElementById('commentsContent').value;

            fetch('/review/addComment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    reviewNo: reviewNo,
                    commentsContent: commentsContent
                }),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('댓글 추가 실패');
                }
                return response.json();
            })
            .then(data => {
                // 성공적으로 댓글이 추가되면 댓글 목록을 갱신
                document.querySelector('.error-message').textContent = '';
                const commentList = document.querySelector('.comment-list');
                const newComment = document.createElement('li');
                newComment.textContent = data.commentsContent; // 서버에서 응답받은 댓글 내용
                commentList.appendChild(newComment);
                document.getElementById('commentsContent').value = ''; // 입력란 초기화
            })
            .catch(error => {
                document.querySelector('.error-message').textContent = error.message;
            });
        }
    </script>
</head>
<body>

<h1>리뷰 상세 정보</h1>

<div class="review-container">
    <h2>리뷰 점수: <span th:text="${review.reviewScore}"></span></h2>
    <p>리뷰 내용: <span th:text="${review.reviewContent}"></span></p>
    <p>작성자: <span th:text="${review.userName}"></span></p>
    <p>작성일: <span th:text="${#dates.format(review.reviewDt, 'yyyy-MM-dd HH:mm')}"></span></p>
    <p>최종 수정일: <span th:text="${#dates.format(review.currReviewUpdate, 'yyyy-MM-dd HH:mm')}"></span></p>
    <p>별점: <span th:text="${review.reviewScore}"></span>점</p>
    <p>매장 이름: <span th:text="${review.storeName}"></span></p>
    <p>좋아요 수: <span th:text="${review.reviewLikeCnt}"></span></p>
    <p>댓글 수: <span th:text="${#lists.size(review.commentList)}"></span></p>
</div>

<div class="comment-section">
    <h2>댓글 작성하기</h2>
    <form action="/review/addreview?reviewNo=${reviewNo}" method="post">
        <input type="hidden" name="reviewNo" th:value="${review.reviewNo}" >
        <textarea name="commentsContent" placeholder="댓글을 입력하세요" required></textarea><br/>
        <button type="submit">댓글 추가</button>
    </form>

    <!-- 에러 메시지 표시 -->
    <div class="error-message" th:if="${errorMessage}" th:text="${errorMessage}"></div>

    <h2>댓글 목록</h2>
    <ul>
        <li th:each="comment : ${commentList}">
            <p th:text="${comment.commentsContent}"></p>
        </li>
    </ul>
</div>

<a th:href="@{/review/getReviewList}">리뷰 목록으로 돌아가기</a>

</body>
</html>