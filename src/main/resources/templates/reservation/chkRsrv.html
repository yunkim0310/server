<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>결제 확인 페이지</title>
    <script src="https://js.tosspayments.com/v1"></script>

    <link rel="stylesheet" href="/css/templates/style.css">
    <link rel="stylesheet" href="/css/templates/regist_hp.css">

    <style>
        table {
            border-spacing: 0 10px; /* 행 간 간격 */
            border-collapse: separate; /* 셀 간 간격 유지 */
            width: 100%; /* 테이블 전체 너비 */
        }

        th, td {
            padding: 10px 15px; /* 셀 내부 여백 */
            text-align: left; /* 텍스트를 왼쪽 정렬 */
            vertical-align: top; /* 텍스트 수직 정렬 */
            font-weight: bold;
            word-wrap: break-word; /* 단어를 줄바꿈 */
            word-break: break-word; /* 긴 단어를 자르고 줄바꿈 */
            white-space: normal; /* 텍스트를 여러 줄로 표시 */
            font-size: 18px;
        }

        th {
            font-weight: bold; /* 제목 굵게 */
        }
        h1 {
            font-size: 32px; /* 글자 크기 */
            font-weight: bold; /* 굵게 */
            text-align: center; /* 가운데 정렬 */
            margin-top: 20px; /* 위쪽 여백 */
            margin-bottom: 20px; /* 아래쪽 여백 */
        }
        #payButton {
            width: 200px; /* 버튼 너비 */
            height: 60px; /* 버튼 높이 */
            font-size: 20px; /* 글자 크기 */
            font-weight: bold; /* 글자 굵게 */
            background-color: #4880FF; /* 버튼 배경색 */
            color: white; /* 글자 색상 */
            border: none; /* 테두리 제거 */
            border-radius: 10px; /* 둥근 테두리 */
            cursor: pointer; /* 클릭 시 손가락 커서 */
            margin-top: 30px; /* 위쪽 간격 */
        }

        #paymentForm {
            text-align: center; /* 버튼을 가운데 정렬 */
        }
    </style>

</head>
<body>
<div th:insert="~{common/header}" style="margin-top: 8px;"></div>
<div class="wrapper">
    <br/>
    <br/>
<h1>결제 확인 페이지</h1>

    <table>
        <tbody>
        <tr>
            <th style="width: 30%;">가 격</th>
            <td th:text="${reservation.amount}" style="width: 80%;" data-phone></td>
        </tr>
        <tr>
            <th style="width: 30%;">전화 번호</th>
            <td th:text="${reservation.rsrvNumber}" style="width: 80%;" data-phone></td>
        </tr>
        <tr>
            <th style="width: 30%;">예약 번호</th>
            <td th:text="${reservation.rsrvNo}" style="width: 80%;"></td>
        </tr>
        <tr>
            <th style="width: 30%;">매 장 명</th>
            <td th:text="${reservation.storeName}" style="width: 80%;"></td>
        </tr>
        <tr>
            <th style="width: 30%;">예약 날짜</th>
            <td th:text="${#dates.format(reservation.rsrvDt, 'yyyy.MM.dd')}" style="width: 80%;"></td>
        </tr>
        <tr>
            <th style="width: 30%;">예약 시간</th>
            <td th:text="${#dates.format(reservation.rsrvDt, 'HH:mm')}" style="width: 80%;"></td>
        </tr>
        <tr>
            <th style="width: 30%;">예약 인수</th>
            <td th:text="${reservation.rsrvPerson} + '명'" style="width: 80%;"></td>
        </tr>
        <tr>
            <th style="width: 30%;">요청 사항</th>
            <td th:text="${reservation.rsrvReq}" style="width: 80%;"></td>
        </tr>
        <tr>
            <th style="width: 30%;">매장 주소</th>
            <td th:text="${reservation.storeAddr}" style="width: 80%;"></td>
        </tr>
        </tbody>
    </table>

<form id="paymentForm">
    <input type="hidden" id="rsrvNo" th:value="${reservation.rsrvNo}" />
    <input type="hidden" id="amount" th:value="${reservation.amount}" />
    <button type="button" id="payButton">결제하기</button>
</form>

<script th:inline="javascript">
    document.getElementById("payButton").addEventListener("click", function () {
        const rsrvNo = document.getElementById("rsrvNo").value;
        const amount = document.getElementById("amount").value;

        const timestamp = Date.now();

        const orderId = rsrvNo + "_" + timestamp;

        const tossPayments = TossPayments('test_ck_6BYq7GWPVv9AJ5Y9aDxl3NE5vbo1'); // Toss 테스트 키

        tossPayments.requestPayment('카드', {
            amount: amount,
            orderId: orderId,
            orderName: 'Reservation Payment',
            successUrl: window.location.origin +`/reservation/sendRsrv?`,
            failUrl: window.location.origin +`/reservation/failRsrv`
        }).catch(error => {
            console.error('결제 요청 실패:', error);
            alert('결제 요청 중 오류가 발생했습니다.');
        });
    });
</script>
</div>
</body>
</html>