<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <script src="https://js.tosspayments.com/v1"></script>
    <link rel="stylesheet" href="/css/templates/style.css">
    <link rel="stylesheet" href="/css/templates/regist_hp.css">
    <link rel="stylesheet" href="/css/reservation/chkRsrv.css">
</head>
<body>
<div th:insert="~{common/header}" style="margin-top: 8px;"></div>
<div class="wrapper">
    <br/>
    <br/>
<h1>결제 확인 페이지</h1>

    <table>
        <tbody>
        <tr>
            <th style="width: 30%;">가 격</th>
            <td th:text="${reservation.amount}" style="width: 80%;" data-phone></td>
        </tr>
        <tr>
            <th style="width: 30%;">전화 번호</th>
            <td th:text="${reservation.rsrvNumber}" style="width: 80%;" data-phone></td>
        </tr>
        <tr>
            <th style="width: 30%;">예약 번호</th>
            <td th:text="${reservation.rsrvNo}" style="width: 80%;"></td>
        </tr>
        <tr>
            <th style="width: 30%;">매 장 명</th>
            <td th:text="${reservation.storeName}" style="width: 80%;"></td>
        </tr>
        <tr>
            <th style="width: 30%;">예약 날짜</th>
            <td th:text="${#dates.format(reservation.rsrvDt, 'yyyy.MM.dd')}" style="width: 80%;"></td>
        </tr>
        <tr>
            <th style="width: 30%;">예약 시간</th>
            <td th:text="${#dates.format(reservation.rsrvDt, 'HH:mm')}" style="width: 80%;"></td>
        </tr>
        <tr>
            <th style="width: 30%;">예약 인수</th>
            <td th:text="${reservation.rsrvPerson} + '명'" style="width: 80%;"></td>
        </tr>
        <tr>
            <th style="width: 30%;">요청 사항</th>
            <td th:text="${reservation.rsrvReq}" style="width: 80%;"></td>
        </tr>
        <tr>
            <th style="width: 30%;">매장 주소</th>
            <td th:text="${reservation.storeAddr}" style="width: 80%;"></td>
        </tr>
        <tr>
            <th style="width: 30%; color: red;">환불 정책:</th>
            <td style="width: 80%;">
                - 0~3일: 환불 불가<br/>
                - 4~6일: 50% 환불<br/>
                - 7일 이상: 전액 환불 가능
            </td>
        </tr>
        </tbody>
    </table>

<form id="paymentForm">
    <input type="hidden" id="rsrvNo" th:value="${reservation.rsrvNo}" />
    <input type="hidden" id="amount" th:value="${reservation.amount}" />
    <button type="button" id="payButton">결제하기</button>
</form>

<script th:inline="javascript">
    document.getElementById("payButton").addEventListener("click", function () {
        const rsrvNo = document.getElementById("rsrvNo").value;
        const amount = document.getElementById("amount").value;

        const timestamp = Date.now();

        const orderId = rsrvNo + "_" + timestamp;

        const tossPayments = TossPayments('test_ck_6BYq7GWPVv9AJ5Y9aDxl3NE5vbo1'); // Toss 테스트 키

        tossPayments.requestPayment('카드', {
            amount: amount,
            orderId: orderId,
            orderName: 'Reservation Payment',
            successUrl: window.location.origin +`/reservation/sendRsrv?`,
            failUrl: window.location.origin +`/reservation/failRsrv`
        }).catch(error => {
            console.error('결제 요청 실패:', error);
            alert('결제 요청 중 오류가 발생했습니다.');
        });
    });
</script>
</div>
</body>
</html>