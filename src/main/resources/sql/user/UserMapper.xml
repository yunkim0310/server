<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.placeHere.server.dao.user.UserDao">

    <!--    <resultMap id="userSelectMap" type="user">-->
    <resultMap id="userSelectMap" type="com.placeHere.server.domain.User">

        <id property="username" column="username" />

        <result property="id" 			        column="id" 			    jdbcType="BIGINT"  />
        <result property="username" 			column="username" 			jdbcType="VARCHAR" />
        <result property="password"	            column="password" 		    jdbcType="VARCHAR" />
        <result property="email" 	            column="email" 		        jdbcType="VARCHAR" />
        <result property="role" 				column="role" 				jdbcType="VARCHAR" />
        <result property="regDt" 				column="reg_dt" 			jdbcType="DATE"    />
        <result property="profileImg" 			column="profile_img" 		jdbcType="VARCHAR" />
        <result property="loginDt" 				column="login_dt" 			jdbcType="DATE"    />
        <result property="updateDt" 			column="update_dt" 			jdbcType="DATE"    />
        <result property="gender" 		        column="gender" 			jdbcType="VARCHAR" />
        <result property="birth" 		        column="birth" 			    jdbcType="DATE"    />
        <result property="activeStatus" 		column="active_status" 		jdbcType="VARCHAR" />
    </resultMap>


    <!--  로그인  -->
    <update id="login" parameterType="java.lang.String">
        UPDATE user
        SET login_dt = now()
        WHERE username = #{username};
    </update>

    <select id="getUser" parameterType="java.lang.String" resultType="com.placeHere.server.domain.User">
        SELECT
            username,
            password,
            email,
            role,
            active_status,
            reg_dt,
            profile_img,
            login_dt,
            update_dt,
            gender,
            birth
        FROM user
        WHERE username = #{username}
    </select>

    <update id="updateLoginDt" parameterType="java.lang.String">
        UPDATE user
        SET login_dt = NOW()
        WHERE username = #{username}
    </update>

    <insert id="join" parameterType="com.placeHere.server.domain.User">
        INSERT INTO user (username, password, email, role, reg_dt, gender, birth )
        VALUES ( #{username}, #{password}, #{email}, #{role}, NOW(), #{gender}, #{birth}  )
    </insert>

    <update	id="updateUserStatus"	parameterType="com.placeHere.server.domain.User" >
        UPDATE user
        SET
            active_status 	= #{ activeStatus },
            update_dt = NOW()
        WHERE username = #{username}
    </update>

    <update	id="updateUser"	parameterType="com.placeHere.server.domain.User" >
        UPDATE user
        SET
            profile_img 	= #{ profileImg },
            update_dt = NOW()
        WHERE username = #{username}
    </update>

    <select id="getUserList" resultType="com.placeHere.server.domain.User">
        SELECT
            id,
            username,
            password,
            email,
            role,
            active_status,
            reg_dt,
            profile_img,
            login_dt,
            update_dt,
            gender,
            birth
        FROM user
        where role = 'ROLE_USER'
        --         WHERE active_status = 'ACTIVE'
--        ORDER BY reg_dt DESC
    </select>

    <select id="getStoreList" resultType="com.placeHere.server.domain.User">
        SELECT
            id,
            username,
            password,
            email,
            role,
            active_status,
            reg_dt,
            profile_img,
            login_dt,
            update_dt,
            gender,
            birth
        FROM user
        where role = 'ROLE_STORE'
        --         WHERE active_status = 'ACTIVE'
--        ORDER BY reg_dt DESC
    </select>

    <select id="resetPwdValidation" resultType="boolean">
        SELECT COUNT(*)
        FROM user
        WHERE username = #{username}
          AND   email = #{email}
    </select>

    <update id="updatePwd" parameterType="com.placeHere.server.domain.User">
        UPDATE user
        SET password = #{password},
            update_dt = now()
        WHERE username = #{username}
    </update>


</mapper>